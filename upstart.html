<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Web3 Test</title>
    <style type="text/css">
      body {
        font: 14px/18px sans-serif;
      }

      label { 
        display: block; 
        font-size: 12px;
        text-transform: uppercase;
      }
      input[type=text], input[type=number]  { 
        padding: 4px;
        border: 1px solid #CCC;
        border-radius: 3px;
        font-size: 16px;
      }

      button {
        font-size: 18px;
        padding: 5px 10px;
        border-radius: 5px;

      }

      #message {
        padding: 10px;
        border-radius: 5px;
        background-color: #EEE;
        font: 16px/20px sans-serif;
      }

    </style>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script language="javascript" type="text/javascript" src="https://cdn.rawgit.com/ethereum/web3.js/1.0/dist/web3.min.js"></script>

    <script type="text/javascript">
      $(function() {
        let contract_address = "0xEB26940E9970CF85AC7646F42e48b8411A86C71a";
        var abi, web3;
        var account_address;

        $('#contract-address').val(contract_address)

        function find_art_data(contract_address) {
          var contract = new web3.eth.Contract(abi, contract_address);

          contract
            .methods
            .artdata()
            .call({from: account_address})
            .then(function(response) {
              console.log(response);

              // Set field values:
              /*
                $('#title').val();
                $('#artist-name').val();
                $('#year').val();
                $('#country-city').val();
                $('#artform').val();
                $('#dimensions').val();
                $('#first-sale-info').val();
              */
            }, function(e) {
              update_message('Failed. <br>' + e.message);
              console.error(e);
            });
        }

        function load() {
          web3 = new Web3();
          web3.setProvider(Web3.givenProvider || "ws://localhost:8546");
          console.log('Provider:', Web3.givenProvider);
          web3.eth
            .getAccounts()
            .then(function(a) { 
              account_address = a[0];
              update_message('Ready. Account address: ' + account_address);
            });
        }

        function update_message(message) {
          $('#message').html(message).show();
        }

        function clear_message() {
          $('#message').empty().hide();
        }

        $('form').on('submit', function(e) { e.preventDefault() });

        $('#load').on('click', function(e) {
          e.preventDefault();

          update_message("Loading...");
          contract_address = $('#contract-address').val()
          find_art_data(contract_address);
        });

        $('#submit').on('click', function(e) {
          e.preventDefault();

          update_message("Saving...");

          var contract = new web3.eth.Contract(abi, contract_address);

          contract.methods
            .setArtData(
              $('#title').val(),
              $('#artist-name').val(),
              $('#year').val(),
              $('#country-city').val(),
              $('#artform').val(),
              $('#dimensions').val(),
              $('#first-sale-info').val()
            )
            .call({from: account_address})
            .then(function(response) {
              update_message('Finished updating!')
              console.log('Response:', response);
            }, function(error) {
              update_message('Failed to save. <br>' + e.message);
              console.error(e);
            });
        });

        $.getJSON('AdappcityArtwork-ABI.json', function(data) {
          abi = data;
          load();
        });
      });
    </script>
  </head>

  <body>
    <h1>Web3 - Uppstart Test</h1>

    <form method="post">
      <div id="message" style="display: none"></div>
      <p>
        <label for="contract-address">Contract Address</label>
        <input type="text" id="contract-address" size="60">
        <button id="load">Load Data</button>
      </p>

      <p>
        <label for="title">Title</label>
        <input type="text" id="title">
      </p>

      <p>
        <label for="artist-name">Artist Name</label>
        <input type="text" id="artist-name">
      </p>

      <p>
        <label for="year">Year Created</label>
        <input type="number" id="year">
      </p>

      <p>
        <label for="country-city">Origin Country and City</label>
        <input type="text" id="country-city">
      </p>

      <p>
        <label for="artform">Art Form</label>
        <input type="text" id="artform">
      </p>

      <p>
        <label for="dimensions">Dimensions</label>
        <input type="text" id="dimensions">
      </p>

      <p>
        <label for="first-sale-info">First Sale Info</label>
        <input type="text" id="first-sale-info">
      </p>

      <p>
        <button id="submit">Save</button>
      </p>
    </form>
  </body>
</html>
